NAME=nvidia
VERSION=1.0_7174
ARCH=i686
RELEASE=1
URL="http://www.nvidia.com/"
DESC="nVIDIA Linux Display Driver."
GROUP=drivers
LICENSE="NVIDIA"
SIZE="9229K"

SOURCES="http://download.nvidia.com/XFree86/Linux-x86/1.0-7174/NVIDIA-Linux-x86-1.0-7174-pkg1.run
         nvidia-1.0-7167-makefiles.patch "

BUILDTIME="kernel-headers"

RUNTIME="xorg module-init-tools"

PROVIDES="opengl"

build() {
  cd $SRC
  
  export PKG_NOSTRIP=1
#  export SYSOUT=/usr/src/linux
    
  sh NVIDIA-Linux-x86-1.0-7174-pkg1.run --extract-only
  cd NVIDIA-Linux-x86-1.0-7174-pkg1
  
  patch -p1 < ../nvidia-1.0-7167-makefiles.patch
  
  mkdir -p $PKG/usr/{bin,lib}
  mkdir -p $PKG/usr/X11R6/lib/modules/{drivers,extensions}

  make ROOT=$PKG install
  
  install -m 0644 usr/lib/libGL.la $PKG/usr/lib/
  sed -i -e 's|__LIBGL_PATH__|/usr/lib|' $PKG/usr/lib/libGL.la
  
  mkdir -p $PKG/usr/include/nvidia
  cp -r usr/include/GL $PKG/usr/include/nvidia/
  
  install -m 0755 usr/bin/nvidia-settings $PKG/usr/bin/
  
  cd usr/src/nv
  IGNORE_CC_MISMATCH=1 make -f Makefile.kbuild module
  
  ln -s libGL.so.1.0.7174 $PKG/usr/lib/libGL.so.1
  ln -s libGLcore.so.1.0.7174 $PKG/usr/lib/libGLcore.so.1
  ln -s libnvidia-tls.so.1.0.7174 $PKG/usr/lib/libnvidia-tls.so.1
  
  install -m 0644 -D nvidia.ko $PKG/lib/modules/`uname -r`/kernel/drivers/video/nvidia.ko
  
#  install_docs
}

