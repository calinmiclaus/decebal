NAME=amavisd-new
VERSION=2.2.1
ARCH=i686
RELEASE=1
URL="http://www.ijs.si/software/amavisd/"
DESC="An interface between MTA and one or more content checkers."
GROUP=mail
LICENSE=GPLv2

SOURCES="http://www.ijs.si/software/amavisd/amavisd-new-2.2.1.tar.gz
         amavisd.init"

RUNTIME="mail-spamassasin
         archive-tar-perl
         archive-zip-perl
	 compress-zlib-perl
	 convert-tnef-perl
	 convert-uulib-perl
	 mime-base64-perl
	 mime-tools-perl
	 mailtools-perl
	 net-server-perl
	 io-stringy-perl
	 unix-syslog-perl
	 berkleydb-perl
	 dbi-perl
	 dbd-mysql-perl
	 >=file-4.12
	 >=gzip-1.3.5
	 >=bzip2-1.0.2
	 arc
	 lha
	 unarj
	 unrar
	 zoo
	 cpio"
	 
build() {
  cd $SRC/$NAME-$VERSION
  
  install -D -m 0755 amavisd $PKG/usr/sbin/amavisd
  install -D -m 0644 amavisd.conf $PKG/etc/amavisd.conf
  
  mkdir -p $PKG/var/lib/amavis/{tmp,db,var}
  mkdir -p $PKG/var/spool/virusmails
  
  # correct some variables in /etc/amavisd.conf
  sed -i "s:\$daemon_user  = 'vscan'\;:\$daemon_user  = 'amavis'\;:" $PKG/etc/amavisd.conf
  sed -i "s:\$daemon_group = 'vscan'\;:\$daemon_group = 'avirus'\;:" $PKG/etc/amavisd.conf
  sed -i "s:\$mydomain = 'example.com'\;:\$mydomain = 'localhost'\;:" $PKG/etc/amavisd.conf
  sed -i "s:\$MYHOME   = '/var/amavis'\;:\$MYHOME   = '/var/lib/amavis'\;:" $PKG/etc/amavisd.conf
  sed -i "s:\$QUARANTINEDIR = '/var/virusmails'\;:\$QUARANTINEDIR = '/var/spool/virusmails'\;:" $PKG/etc/amavisd.conf          
  
  install -D -m 0700 ../amavisd.init $PKG/etc/rc.d/amavisd
  
  install_docs AAAREADME.first INSTALL LICENSE MANIFEST RELEASE_NOTES TODO
}
