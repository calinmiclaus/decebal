#!/bin/bash

pkg_ssp() {
  local NEWFLAGS=""
  local NEWCXXFLAGS=""

  cat << EOF > $TMP/propolice.c
int main() {
    return 0 ;
}
EOF
  gcc $TMP/propolice.c -o $TMP/propolice -fstack-protector-all -fstack-protector 2>/dev/null
  if [ -x $TMP/propolice ]
  then
    msg_verbose_nnl "activating smash stack protector (SSP)..."    
    for FLAG in $(echo $CFLAGS)
    do
      if [ "$FLAG" != "-fstack-protector" -a "$FLAG" != "-fstack-protector-all" ]
      then
        NEWCFLAGS="$NEWCFLAGS $FLAG"
      fi
    done
    for FLAG in $(echo $CXXFLAGS)
    do
      if [ "$FLAG" != "-fstack-protector" -a "$FLAG" != "-fstack-protector-all" ]
      then
        NEWCXXFLAGS="$NEWCXXFLAGS $FLAG"
      fi
    done
    export CFLAGS="$NEWCFLAGS -fstack-protector -fstack-protector-all"
    export CXXFLAGS="$NEWCXXFLAGS -fstack-protector -fstack-protector-all"
    msg_done_verbose
  else
    msg_warning "your gcc does not have Smash Stack Protector support."
  fi
}
